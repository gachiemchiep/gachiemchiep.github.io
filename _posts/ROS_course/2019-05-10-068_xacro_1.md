---
title: "ROS course 68: using xarco part 1"
excerpt: "ROS's learning couse part 68:  using xarco part 1."
categories: 
  - ROS_srs
tags: 
  - tutorial
  - C++
  - Robot
comments: true
published: true
toc: true
support: true
order: 9
author: vugia.truong
---

# 1. Environment

This post is tested under the following Environment:

| Item | Value |
|:-:|:-:|
| CPU | AMD Ryzen 5 2600 |
| Ubuntu | 18.04 |
| ROS | Melodic |

For  installation, see [02 Install](/ros_srs/002_install). 
The source code of all parts is upload of github, see 
[11 git](/ros_srs/011_git_repo) for more detail.

# 2. Summary

URDF (Unified Robot Description Format) is the standard ROS XML representation 
of the robot model [source](http://sdk.rethinkrobotics.com/wiki/URDF). 
which result in very long file and hard to co-operate between team. 

Let's compare between urdf and xacro in industrial example. Baxter robot's urdf is at 
[baxer.urdf](https://github.com/RethinkRobotics/baxter_common/blob/6c4b0f375fe4e356a3b12df26ef7c0d5e58df86e/baxter_description/urdf/baxter.urdf)
is **1600** lines long. 
By using xacro, the baxer.urdf is separated into 5 separated files which only **523** lines in summary.
(xacro files is [1](https://github.com/RethinkRobotics/baxter_common/blob/6c4b0f375fe4e356a3b12df26ef7c0d5e58df86e/baxter_description/urdf/baxter.urdf.xacro) , [2](https://github.com/RethinkRobotics/baxter_common/blob/6c4b0f375fe4e356a3b12df26ef7c0d5e58df86e/baxter_description/urdf/pedestal/pedestal.xacro), [3](https://github.com/RethinkRobotics/baxter_common/blob/6c4b0f375fe4e356a3b12df26ef7c0d5e58df86e/baxter_description/urdf/left_end_effector.urdf.xacro), [4](https://github.com/RethinkRobotics/baxter_common/blob/6c4b0f375fe4e356a3b12df26ef7c0d5e58df86e/baxter_description/urdf/right_end_effector.urdf.xacro), 
[5](https://github.com/RethinkRobotics/baxter_common/blob/6c4b0f375fe4e356a3b12df26ef7c0d5e58df86e/baxter_description/urdf/baxter_base/baxter_base.gazebo.xacro) correspondingly)

Xacro have the following features. (See [ros_wiki/xacro](http://wiki.ros.org/xacro) for full list and explaination)

1. Property and property blocks : use to create and set variable
2. Mathemetics
3. Conditions
4. Macros : very useful when statements are repeated or reused with modification defined by parameters
5. Can use rospack
6. Can include other xacro files

Source code is as follow

```bash
ros_lecture/vis_lecture/
├── launch
├── package.xml
├── rviz
├── src
├── stl
├── urdf
└── xacro
    ├── basic1.urdf
    ├── basic1.xacro
    ├── basic2.xacro
    ├── basic3.xacro  
    ├── basic4.xacro
    ├── basic5_h.xacro
    ├── basic5.xacro
    └── basic6.xacro
```

# 3. Example

## 3.1. property block

```xml
<!-- vis_lecture/xacro/basic1.xacro -->
<robot name="test_robot" xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- Create property block -->
  <xacro:property name="side" value="0.5" />

  <link name="base_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <!-- Use property block instead of fixed variable -->
        <box size="${side} ${side} ${side}" />
      </geometry>
      <material name="red">
        <color rgba="1.0 0.0 0.0 2.0"/>
      </material>
    </visual>
  </link>
</robot>
```

Run

```bash
roscd vis_lecture/xacro/
roslaunch urdf_tutorial display.launch model:=basic1.xacro
```

A box with size = 0.5 is created as follow 

![vis_xacro1.png](https://qiita-image-store.s3.amazonaws.com/0/254442/a82f17b5-b9e2-17ef-b82f-1cac073acb6e.png)

Unlike urdf, there isn't check_xacro command to check whether xacro file is correctly written.
So we need to convert xacro into urdf first, then use **check_urdf** tool to check genarated urdf. 
Use the following command to convert xacro into urdf

```shell
roscd vis_lecture/xacro/
rosrun xacro xacro basic1.xacro --inorder >basic1.urdf
```

Check detail of genarated urdf

```xml
<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from basic1.xacro                   | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="test_robot" xmlns:xacro="http://ros.org/wiki/xacro">
  <link name="base_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.5 0.5 0.5"/>
      </geometry>
      <material name="red">
        <color rgba="1.0 0.0 0.0 2.0"/>
      </material>
    </visual>
  </link>
</robot>
```

Run the following command to check urdf. 

```shell
roscd vis_lecture/xacro/
rosrun xacro xacro basic1.xacro --inorder >basic1.urdf
check_urdf basic1.urdf 
```

If there isn't any error: 

```shell
robot name is: test_robot
---------- Successfully Parsed XML ---------------
root Link: base_link has 0 child(ren)
```

## 3.2. Mathemetics

 Xacro employs python to evaluate expressions enclosed in dollared-braces, **${}**

```xml
<!-- vis_lecture/xacro/basic2.xacro -->
<robot name="test_robot" xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:property name="side" value="0.5" />
  <material name="red">
    <color rgba="1.0 0.0 0.0 2.0"/>
  </material>

  <link name="base_link"/>

  <joint name="body0_joint" type="fixed">
    <!-- Equation 1 -->
    <origin rpy="0 0 0" xyz="${0.5*cos(radians(0))} ${0.5*sin(radians(0))} 0"/>
    <parent link="base_link"/>
    <child  link="body0_link"/>
  </joint>
  <link name="body0_link">
    <visual>
      <geometry>
        <box size="0.1 0.1 0.1" />
      </geometry>
      <material name="red"/>
    </visual>
  </link>

  <joint name="body1_joint" type="fixed">
    <!-- Equation 2 -->
    <origin rpy="0 0 0" xyz="${0.5*cos(radians(30))} ${0.5*sin(radians(30))} 0"/>
    <parent link="base_link"/>
    <child  link="body1_link"/>
  </joint>
  <link name="body1_link">
    <visual>
      <geometry>
        <box size="0.1 0.1 0.1" />
      </geometry>
      <material name="red"/>
    </visual>
  </link>

  <joint name="body2_joint" type="fixed">
    <!-- Equation 3 -->
    <origin rpy="0 0 0" xyz="${0.5*cos(radians(60))} ${0.5*sin(radians(60))} 0"/>
    <parent link="base_link"/>
    <child  link="body2_link"/>
  </joint>
  <link name="body2_link">
    <visual>
      <geometry>
        <box size="0.1 0.1 0.1" />
      </geometry>
      <material name="red"/>
    </visual>
  </link>
</robot>
```

Run program

```shell
roscd vis_lecture/xacro/
roslaunch urdf_tutorial display.launch model:=basic2.xacro 
```

Result

![vis_xacro2.png](https://qiita-image-store.s3.amazonaws.com/0/254442/d72c52e6-45ea-89f7-cda3-939f38ecccdf.png)

## 3.3. Conditions

```xml
<!-- vis_lecture/xacro/basic3.xacro -->
<robot name="test_robot" xmlns:xacro="http://ros.org/wiki/xacro">
<!-- Change into red-blue to see color of box change -->
  <xacro:property name="color" value="red" />

  <material name="red">
    <color rgba="1.0 0.0 0.0 2.0"/>
  </material>
  <material name="blue">
    <color rgba="0.0 0.0 1.0 2.0"/>
  </material>

  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.1 0.1 0.1" />
      </geometry>
      <xacro:if value="${color=='red'}">
        <material name="red"/>
      </xacro:if>
      <xacro:if value="${color=='blue'}">
        <material name="blue"/>
      </xacro:if>
    </visual>
  </link>
</robot>

```

Execute program

```shell
roscd vis_lecture/xacro/
roslaunch urdf_tutorial display.launch model:=basic3.xacro 
```

Result is as follow 

![vis_xacro3.png](https://qiita-image-store.s3.amazonaws.com/0/254442/7db4f3fb-05da-1003-8168-75c75fdfcb4e.png)

# 4. Reference
1. [roswiki: xacro](ros.org/wiki/xacro)

# 5. Table of Contents

[ROS TOC](/ros_srs/000_TOC/)

